#!/bin/bash

relies_on(){
	for container in "$@"; do
		local state
		state=$(docker inspect --format "{{.State.Running}}" "$container" 2>/dev/null)

		if [[ "$state" == "false" ]] || [[ "$state" == "" ]]; then
			echo "$container is not running, starting it for you."
			$container
		fi
	done
}

relies_on pulseaudio

docker run -d \
    --rm \
    --memory 2gb \
    --net host \
    --cpuset-cpus 0 \
    -v /etc/localtime:/etc/localtime:ro \
    -v /tmp/.X11-unix:/tmp/.X11-unix \
    -v "${HOME}/.firefox/cache:/home/firefox/.cache/mozilla" \
    -v "${HOME}/.firefox/mozilla:/home/firefox/.mozilla" \
    -v "${HOME}/Downloads:/home/firefox/Downloads" \
    -v "${HOME}/Pictures:/home/firefox/Pictures" \
    -v "${HOME}/Torrents:/home/firefox/Torrents" \
    -e "DISPLAY=unix${DISPLAY}" \
    -e GDK_SCALE \
    -e GDK_DPI_SCALE \
    -v /dev/shm:/dev/shm \
    -e PULSE_SERVER=pulseaudio \
    --device /dev/snd \
    --device /dev/dri \
    --device /dev/video0 \
    --group-add audio \
    --group-add video \
    --name firefox \
    firefox "$@"
    #${DOCKER_REPO_PREFIX}/firefox "$@"
