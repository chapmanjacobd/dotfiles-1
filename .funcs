#!/bin/sh

fork-sync() {
    forks=$GITHUB_FORKS
    while IFS=, read -d, -r forks; do
	repo=$forks    
        cd "$GITHUB_REPO_ROOT/$repo"
        curr_branch=$(git rev-parse --abbrev-ref HEAD)
        if [ $curr_branch = "master" ] || [ $curr_branch = "trunk" ] ; then
            echo "Syncing fork in $repo..."
            git pull upstream $curr_branch
            changed=$(git log origin/${curr_branch}..${curr_branch})

            if [ -n "${changed}" ]; then
                echo "Pushing changes to origin..."
                git push origin $curr_branch
            else
                echo "No changes"
            fi
            unset changed
        else
            echo "Working in branch $curr_branch.  Not Syncing"
        fi
        unset curr_branch
        cd -
    done <<< "${forks,+"${forks},"}"
    unset repo
    unset forks
}
